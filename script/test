#!/bin/bash

clean_generated_code() {
./clean_generated_code
}

echo "running Hot Glue internal specs (install, basic commands)..."
# the internal specs test only Hot Glue's command line usage
rspec spec

script/clean_generated_code

echo "Integration suite for Hot Glue..."
# note that the dummy/ is in the root of the repository
# these specs generate several controllers & specs and then run the generated
# specs to test the generated code

cd dummy

echo "setting up database..."

bundle install
rake db:create db:reset db:test:prepare

echo "Generating Abcs with rails generate hot_glue:scaffold Abc --gd"
rails generate hot_glue:scaffold Abc --gd

# problem: I think I need to re-load the app here so that the newly generated code gets picked up


rspec spec || exit

cd ../

script/clean_generated_code

